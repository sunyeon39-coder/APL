<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tournament Hub</title>
  <link rel="stylesheet" href="./hub.css" />
</head>
<body>

<!-- ================= TOP BAR ================= -->
<div class="topbar">
  <button id="menuBtn" class="menu-btn">â˜°</button>

  <div class="title">Tournament Hub</div>

  <button class="topbar-right profile-area" id="profileArea">
    <img id="profileImg" src="https://via.placeholder.com/32" />
    <span id="profileName">ë‚´ í”„ë¡œí•„</span>
  </button>
</div>

<!-- ================= SIDE MENU ================= -->
<div id="sideMenu" class="side-menu">
  <ul>
    <li id="profileBtn">ë‚´ í”„ë¡œí•„</li>
    <li id="userManageBtn" class="admin-only">User Management</li>
    <li>ëŒ€íšŒ / íšŒì‚¬</li>
    <li>ì„¤ì •</li>
    <li id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</li>
  </ul>
</div>

<div id="overlay" class="overlay"></div>

<!-- ================= MAIN ================= -->
<div class="main">
  <div class="section-head">
    <div class="section-title">ëŒ€íšŒ / íšŒì‚¬</div>
    <button id="createEventBtn" class="create-btn">+ Create Event</button>
  </div>

  <div id="tournamentList" class="tournament-list"></div>

  <div id="tournamentEmpty" class="empty hidden">
    ë“±ë¡ëœ ëŒ€íšŒê°€ ì—†ìŠµë‹ˆë‹¤.
  </div>
</div>

<!-- ================= EVENT MODAL ================= -->
<div id="eventModal" class="modal hidden">
  <div class="modal-box">
    <h3>ëŒ€íšŒ ìƒì„±</h3>
    <input id="eventName" placeholder="ëŒ€íšŒëª…" />
    <input id="eventLocation" placeholder="ì§€ì—­" />
    <input id="eventStart" type="date" />
    <input id="eventEnd" type="date" />

    <div class="modal-actions">
      <button id="eventCancelBtn">ì·¨ì†Œ</button>
      <button id="eventSaveBtn">ì €ì¥</button>
    </div>
  </div>
</div>

<!-- ================= NICKNAME MODAL ================= -->
<div id="nicknameModal" class="modal hidden">
  <div class="modal-box">
    <h3>ë‹‰ë„¤ì„ ì„¤ì •</h3>
    <p>ë‹¤ë¥¸ ì‚¬ìš©ìì—ê²Œ í‘œì‹œë  ì´ë¦„ì…ë‹ˆë‹¤.</p>

    <input
      id="nicknameInput"
      placeholder="ë‹‰ë„¤ì„"
      maxlength="20"
    />

    <div class="modal-actions">
      <button id="nicknameSaveBtn">ì €ì¥</button>
    </div>
  </div>
</div>

<!-- ================= AUTH GUARD (FIXED) ================= -->
<script type="module">
  import { auth } from "./firebase.js";
  import {
    onAuthStateChanged,
    signOut
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  console.log("ğŸ”¥ hub auth guard loaded");

  // âš ï¸ redirect ë£¨í”„ ë°©ì§€ìš©
  let resolved = false;

  onAuthStateChanged(auth, user => {
    if (resolved) return;
    resolved = true;

    if (!user) {
      console.log("â›” hub: not logged in â†’ login");
      location.replace("login.html");
      return;
    }

    console.log("âœ… hub: logged in", user.email);
  });

  // ë¡œê·¸ì•„ì›ƒ
  document.getElementById("logoutBtn")?.addEventListener("click", async () => {
    await signOut(auth);
    location.replace("login.html");
  });
</script>

<!-- ================= HUB APP LOGIC ================= -->
<script type="module" src="./hub.js"></script>

</body>
</html>
