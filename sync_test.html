<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Sync Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <style>
    body{
      margin:0;
      font-family: system-ui, -apple-system, sans-serif;
      background:#0f1220;
      color:#e9ecff;
      display:flex;
      align-items:center;
      justify-content:center;
      height:100vh;
    }
    .card{
      background:#171a2b;
      border-radius:18px;
      padding:24px 28px;
      box-shadow:0 10px 30px rgba(0,0,0,.35);
      text-align:center;
      min-width:260px;
    }
    .value{
      font-size:42px;
      font-weight:900;
      margin:12px 0 20px;
    }
    button{
      border:none;
      background:#4aa3ff;
      color:#0f1220;
      font-weight:800;
      padding:10px 18px;
      border-radius:999px;
      cursor:pointer;
      font-size:16px;
    }
    button:active{ transform:scale(.96); }
  </style>
</head>
<body>

  <div class="card">
    <div>ðŸ”¥ Real-time Sync Value</div>
    <div id="value" class="value">0</div>
    <button id="incBtn">+1</button>
  </div>

  <script type="module">
    import { db } from "./firebase.js";
    import {
      doc,
      setDoc,
      onSnapshot,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // ðŸ”¥ í…ŒìŠ¤íŠ¸ìš© ë‹¨ì¼ ë¬¸ì„œ
    const REF = doc(db, "boxboard_test", "sync");

    const valueEl = document.getElementById("value");
    const btn = document.getElementById("incBtn");

    // ì‹¤ì‹œê°„ êµ¬ë…
    onSnapshot(REF, snap => {
      if (!snap.exists()) return;
      valueEl.textContent = snap.data().value ?? 0;
    });

    // ë²„íŠ¼ í´ë¦­ â†’ Firestore ì—…ë°ì´íŠ¸
    btn.onclick = async () => {
      const next = Number(valueEl.textContent) + 1;
      await setDoc(
        REF,
        { value: next, updatedAt: serverTimestamp() },
        { merge:true }
      );
    };
  </script>

</body>
</html>
