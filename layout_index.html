<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover"
  />
  <script>document.documentElement.classList.add('page-enter');</script>
  <title>Layout</title>

  <!-- Í≥µÌÜµ / Î†àÏù¥ÏïÑÏõÉ Ïä§ÌÉÄÏùº -->
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="layout_styles.css">
</head>

<!-- ================= LAYOUT AUTH GUARD ================= -->
<script type="module">
  import { auth } from "./firebase.js";
  import {
    onAuthStateChanged
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  const params = new URLSearchParams(location.search);

  let eventId = params.get("eventId");
  const boxId = params.get("boxId");

  // üî• indexÏôÄ ÎèôÏùºÌïú eventId Î≥µÏõê Î°úÏßÅ
  if (!eventId) {
    eventId = sessionStorage.getItem("eventId");
  }

  if (eventId) {
    sessionStorage.setItem("eventId", eventId);
  }

  onAuthStateChanged(auth, user => {
    if (!user) {
      location.replace("login.html");
      return;
    }

    // boxIdÎäî layout ÌïÑÏàò
    if (!boxId) {
      location.replace(
        `index.html${eventId ? `?eventId=${eventId}` : ""}`
      );
      return;
    }
  });
</script>

<body>

  <!-- =========================
       Loading Overlay (ÏÑ†ÌÉù)
       ‚ùó Ï†àÎåÄ header ÏúÑÎ°ú Î™ª Ïò¨ÎùºÍ∞ê
  ========================== -->
  <div
    id="layoutBootLoading"
    class="layout-loading hidden"
    aria-hidden="true"
  >
    <div class="spinner"></div>
    <div>Loading‚Ä¶</div>
  </div>

  <!-- =========================
       TOP BAR (üî• ÏµúÏÉÅÎã® Í≥†Ï†ï)
       Back Î≤ÑÌäº ÏïàÏ†Ñ ÏòÅÏó≠
  ========================== -->
  <div class="layout-top">
    <button
      id="addSeatBtn"
      class="btn"
      type="button"
    >
      + Seat Ï∂îÍ∞Ä
    </button>

    <a
      id="layoutBackBtn"
      class="btn back-btn"
      href="index.html"
      onclick="__go(this.href,true); return false;"
    >
      Back
    </a>
  </div>

  <!-- =========================
       MAIN WRAP
       headerÏôÄ ÏôÑÏ†ÑÌûà Î∂ÑÎ¶¨
  ========================== -->
  <div class="layout-wrap">

    <!-- =========================
         TOP AREA (Ï¢åÏÑù / Ïä§ÌÅ¨Î°§)
         ‚ùó header ÏòÅÏó≠ Ïπ®Î≤î Í∏àÏßÄ
    ========================== -->
    <div class="top-area">
      <div
        class="layout-grid"
        id="layoutGrid"
        aria-label="Seat Layout"
      >
        <!-- Seat Ïπ¥ÎìúÎì§ JSÏóêÏÑú ÏÉùÏÑ± -->
      </div>
    </div>

    <!-- =========================
         BOTTOM AREA (ÎåÄÍ∏∞Ïûê)
    ========================== -->
    <div class="bottom-area">

      <!-- ÎåÄÍ∏∞Ïûê ÏûÖÎ†• (userÏùº Í≤ΩÏö∞ JSÏóêÏÑú Ï†úÍ±∞Îê®) -->
      <div
        class="waiting-header"
        role="group"
        aria-label="ÎåÄÍ∏∞Ïûê Ï∂îÍ∞Ä"
      >
        <input
          id="waitingNameInput"
          type="text"
          inputmode="text"
          autocomplete="off"
          placeholder="ÎåÄÍ∏∞Ïûê Ïù¥Î¶Ñ"
        />
        <button
          id="addWaitingBtn"
          type="button"
        >
          + ÎåÄÍ∏∞Ïûê Ï∂îÍ∞Ä
        </button>
      </div>

      <div class="wait-scroll">
        <section
          id="waitingList"
          class="waiting-grid"
          aria-label="ÎåÄÍ∏∞Ïûê Î™©Î°ù"
        >
          <!-- ÎåÄÍ∏∞Ïûê Ïπ¥Îìú -->
        </section>
      </div>

    </div>

  </div>

  <!-- =========================
       Page Transition Helper
  ========================== -->
  <script>
    window.__go = function(url, replace){
      try{
        document.documentElement.classList.add('page-exit');
        document.body.style.visibility = 'hidden';
      }catch(e){}
      replace ? location.replace(url) : location.href = url;
    };
    window.addEventListener('DOMContentLoaded', function(){
      document.documentElement.classList.remove('page-enter');
      document.documentElement.classList.add('page-ready');
    }, { once:true });
  </script>

  <!-- =========================
       Layout App JS
  ========================== -->
  <script type="module" src="layout_app.js"></script>

</body>
</html>
